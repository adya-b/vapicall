<!doctype html>
<html>
  <head><meta charset="utf-8"><title>Screening Debug</title></head>
  <body>
    <h1>Screening Debug</h1>
    <p id="u"></p>
    <pre id="log" style="white-space:pre-wrap;border:1px solid #ccc;padding:8px"></pre>
    <button id="start" disabled>Start screening</button>

    <script>
      const ASSISTANT_ID   = "0e518834-8969-441a-a215-dc181b2c9f87";
      const PUBLIC_API_KEY = "b0c5c612-2941-48c2-8438-ea8b3845eaf7";
      const WEBHOOK_URL    = "https://hook.eu2.make.com/6fz2majfttrxkm77g5on9ip7wk96587v";

      const url = new URL(location.href);
      const recId = url.searchParams.get("rec") || "";
      const name  = url.searchParams.get("name") || "";
      document.getElementById("u").textContent = `rec=${recId} | name=${name}`;

      const log = (m) => { const el = document.getElementById("log"); el.textContent += m + "\n"; };

      // load SDK with explicit error hook
      const s = document.createElement("script");
      s.src = "https://cdn.jsdelivr.net/gh/VapiAI/html-script-tag@latest/dist/assets/index.js";
      s.defer = true;
      s.async = true;
      s.onerror = () => log("ERROR: SDK failed to load (blocked or network).");
      s.onload  = () => {
        log("SDK loaded.");
        if (!window.vapiSDK) { log("ERROR: window.vapiSDK missing."); return; }
        try {
          const inst = window.vapiSDK.run({
            apiKey: PUBLIC_API_KEY,
            assistant: ASSISTANT_ID,
            serverUrl: WEBHOOK_URL,
            metadata: { airtableRecordId: recId, candidateName: name, webhookUrl: WEBHOOK_URL },
            config: { position: "hidden" }
          });
          log("SDK initialized.");
          const btn = document.getElementById("start");
          btn.disabled = false;
          btn.onclick = () => { log("Startingâ€¦"); inst.start(); };
        } catch (e) {
          log("ERROR during init: " + (e && e.message ? e.message : e));
        }
      };
      document.head.appendChild(s);
    </script>
  </body>
</html>
